import 'package:flutter/material.dart';
import 'package:scoped_model/scoped_model.dart';

import '../models/app_constants.dart';
import '../models/todo_category.dart';
import '../pages/item_page.dart';
import '../widgets/category_header.dart';
import '../widgets/todo_list.dart';
import '../models/app_state.dart';

class CategoryPage extends StatefulWidget {
  //final Category category;
  final int categoryIndex;

  CategoryPage(this.categoryIndex);

  @override
  State<StatefulWidget> createState() {
    return _CategoryState();
  }
}

class _CategoryState extends State<CategoryPage> {

  //---------- build method
  @override
  Widget build(BuildContext context) {
    print("BUILD - category_page");
    Category category =
        ScopedModel.of<AppState>(context).categories[widget.categoryIndex];
    //AppConstants.changeStatusColor(category.color);

    return Scaffold(
      appBar: AppBar(
        title: Text(category.name),
        backgroundColor: category.color,
        elevation: 0.0,
      ),
      body: Column(
        children: <Widget>[
          CategoryHeader(
            headerColor: category.color,
            headerCount: category.leftToDoCount,
          ),
          category.items.length == 0
              ? Text("Nothing To Do")
              : ToDoList(
                  items: category.itemsSorted,
                  pageType: PageType.category,
                ),
        ],
      ),
      floatingActionButton: _buildFloatingActionButton(),
    );
  }

  Widget _buildFloatingActionButton() {
    Category category =
        ScopedModel.of<AppState>(context).categories[widget.categoryIndex];

    return FloatingActionButton(
      child: Icon(Icons.add),
      backgroundColor: category.color,
      onPressed: () {
        Navigator.of(context, rootNavigator: true).push(
          MaterialPageRoute(
              builder: (context) => ItemPage(
                    categoryIndex: widget.categoryIndex,
                  )),
        );
      },
    );
  }
}
